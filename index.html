<!DOCTYPE html>
<html>
  <head>
    <title>ICBP 2017 - Systems Biology 2017- User Area</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" type="image/png" href="favicon.ico"/>
  <style>
    body {
    padding-top: 40px;
    padding-bottom: 40px;
    background-color: #eee;
    }
    .form-signin {
    max-width: 330px;
    padding: 15px;
    margin: 0 auto;
    }
    .form-signin .form-signin-heading,
    .form-signin .checkbox {
    margin-bottom: 10px;
    }
    .form-signin .checkbox {
    font-weight: normal;
    }
    .form-signin .form-control {
    position: relative;
    height: auto;
    -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
            box-sizing: border-box;
    padding: 10px;
    font-size: 16px;
    }
    .form-signin .form-control:focus {
    z-index: 2;
    }
    .form-signin input[type="email"] {
    margin-bottom: -1px;
    border-bottom-right-radius: 0;
    border-bottom-left-radius: 0;
    }
    .form-signin input[type="password"] {
    margin-bottom: 10px;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    }
    .form-signin input[type="email"] {
        margin-bottom: 10px;
    }
    .tab-content.form-signin{
        background-color: #fff;
        border: 1px solid #ddd;
        border-top:0;
    }
    img.logo {
        display: block;
        margin: auto;
        width: 300px;
        margin-bottom: 20px;
    }
    .tab-content form-signin {
        background-color: #FFF;
        border: 1px solid #DDD;
        border-top: none;
    }
    fieldset.form-group {
        margin-top:10px;
        margin-bottom:0px;
    }
    .no-padding {
        padding: 0;
    }
    .content-row .content-col {
        background-color: #FFF;
        padding: 30px 15px 15px 15px;
        border: 1px solid #DDD;
        border-top: none;
    }
    form small {
        display: block;
        margin-bottom: 10px;
    }
    .info-row [class*="col-"]{
        padding: 1.5em;
        background-color: #FFF;
        border: 1px solid #DDD;
        border-top: none;
        border-bottom: none;
    }
    .container .info-row:last-of-type [class*="col-"]{
        border-bottom: 1px solid #DDD;
        padding-top: 0;
    }
    .container .info-row:first-of-type [class*="col-"]{
        padding-bottom:0px;
    }
    #login-container, #info-container {
        display: none;
    }
    .alert:last-of-type {
        margin-bottom: 0px;
    }
    .alert {
        display: none;
    }
    #psForm {
        margin: 50px 0px 35px 0px;
        text-align: center;
        display: none;
    }
    #psForm p, #psForm span {
        text-align: center; font-size: 1.25em;
    }
    #psForm input {
        margin-top: 25px;
    }
    #abstract-view p {
        text-align: center;
        padding-right: 50px;
        padding-left: 50px;
        margin: 0 0 30px;
    }
    #abstract-view #title {
        font-weight: 900;
    }
    #abstract-view #text {
        text-align: justify;
    }
    #abstract-view #keywords {
        text-align: left;
    }
    #abstract-form, #abstract-view {
        display: none;
    }
    /* nav fix */
    .nav-tabs>li {
        height:62px;
    }
    .nav-tabs>li>a, .nav-tabs>li>a>div {
        height:100%;
        display:table;
    }
    .nav-tabs>li>a span {
        display:table-cell;
        vertical-align:middle;
    }
    li[role="presentation"] a {
        width: 100%;
    }
    table {
        width: 100%;
        text-align: center;
    }
    #payment td {
        vertical-align: middle;
    }
  </style>
  </head>
  <body>
    
    <div class="container">
        <!--<a href="../">-->
            <img class="logo" src="icbp.png"/>
        <!--</a>-->
    </div>

    <div class="container" id="login-container">

        <div class="row">

                <!-- Nav tabs -->
                <ul class="nav nav-tabs form-signin no-padding nav-justified" role="tablist" style="padding-bottom:0px;">
                    <li role="presentation" class="active"><a href="#register" aria-controls="home" role="tab" data-toggle="tab"><h4>Register</h4></a></li>
                    <li role="presentation"><a href="#signin" aria-controls="signin" role="tab" data-toggle="tab"><h4>Sign in</h4></a></li>
                    <li role="presentation"><a href="#reset" aria-controls="reset" role="tab" data-toggle="tab"><h4>Password reset</h4></a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content form-signin">

                    <div role="tabpanel" class="tab-pane active" id="register">
                        <form id="registerForm" class="form-signin" name="register">
                            <label for="inputEmail" class="sr-only">Email address</label>
                            <input type="email" id="inputEmailRegister" name="inputEmailRegister" class="form-control" placeholder="Email address" required autofocus="">
                            <label for="inputPassword" class="sr-only">Password</label>
                            <input type="password" id="inputPasswordRegister" name="inputPasswordRegister" class="form-control" placeholder="Password" required>
                            <small id="passwordHelp" class="form-text text-muted">Password must be at least 6 characters long</small>
				            <label for="confirmPassword" class="sr-only">Confirm Password</label>
                            <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm Password" required>
                            <button id="registerBtn" class="btn btn-lg btn-primary btn-block" type="submit">Register</button>
                        </form>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="signin">
                        <form id="signInForm" class="form-signin" name="signin">
                            <label for="inputEmail" class="sr-only">Email address</label>
                            <input type="email" id="inputEmailSignIn" name="inputEmailSignIn" class="form-control" placeholder="Email address" required autofocus>
                            <label for="inputPassword" class="sr-only">Password</label>
                            <input type="password" id="inputPasswordSignIn" name="inputPasswordSignIn" class="form-control" placeholder="Password" required>
                            <button id="signinBtn" class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
                        </form>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="reset">
                        <form id="signInForm" class="form-signin" name="reset">
                            <label for="inputEmail" class="sr-only">Email address</label>
                            <input type="email" id="inputEmailReset" name="inputEmailReset" class="form-control" placeholder="Email address" required autofocus>
                            <button id="resetBtn" class="btn btn-lg btn-primary btn-block" type="submit">Request change</button>
                        </form>
                    </div>

            </div>
        </div>
    </div>

    <!--                -->
    <!-- info-container -->
    <!--                -->
    <div class="container" id="info-container">

        <div class="row">
            <div class="no-padding col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1 col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2">
                <!-- Nav tabs -->
                <ul id="signed-tab" class="nav nav-tabs nav-justified" role="tablist" style="padding-bottom:0px; margin: 0 auto 0 0;">
                    <li role="presentation" class="active"><a href="#info" aria-controls="info" role="tab" data-toggle="tab"><h4>General Info</h4></a></li>
                    <li role="presentation" id="certificateTab"><a href="#certificates" aria-controls="info" role="tab" data-toggle="tab"><h4>Certificates</h4></a></li>
                    <li role="presentation"><a href="#data" aria-controls="data" role="tab" data-toggle="tab"><h4>Data</h4></a></li>
                    <li role="presentation" id="abstractTab"><a href="#abstract" aria-controls="abstract" role="tab" data-toggle="tab"><h4>Abstract</h4></a></li>
                    <li role="presentation"><a href="#payment" aria-controls="payment" role="tab" data-toggle="tab"><h4>Payment</h4></a></li>
                    <li role="presentation" id="logOutTab"><a href="#" aria-controls="logout" role="tab" data-toggle="tab"><h4>Log out</h4></a></li>
                    <!--<button id="logOutBtn" class="btn btn-danger pull-right" style="margin-top: 12px">Log Out</button>-->
                </ul>  
            </div>
        </div>

        <div class="row info-row">
            <div class="col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1 col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2">
                <div class="alert alert-warning" role="alert"><strong>Warning:</strong> Pending payment</div>
                <div id="update-success" class="alert alert-success" role="alert">Information updated successfully</div>
                <div id="payment-success" class="alert alert-success" role="alert">Payment confirmed!</div>
                <div class="alert alert-danger" role="alert"><strong>Error:</strong> Something went wrong</div>
            </div>
        </div>
        
        <div class="row content-row info-row">
            
            <div class="content-col col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1 col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2">

                <!-- Tab content -->
                <div class="tab-content">

                    <!-- tab pane 1 -->
                    <div role="tabpanel" class="tab-pane active" id="info">
                        <p id="oral-countdown" style="font-size: 1.5em;"></p>
                        <p>Left to opt for oral contribution</p>
                        <hr>
                        <p id="poster-countdown" style="font-size: 1.5em;"></p>
                        <p>Left to opt for poster presentation</p>
                        <hr>
                        <p id="db-info"></p>
                    </div>
                    
                    <!-- tab pane certificates -->
                    <div role="tabpanel" class="tab-pane" id="certificates">
                        <a target="_blank" href="#" id="attendeeCertificate">Download attendee certificate</a>
                        <br/>
                        <a target="_blank" href="#" id="speakerCertificate" style="display:none;">Download speaker certificate</a>
                    </div>

                    <!-- tab pane 2 -->
                    <div role="tabpanel" class="tab-pane" id="data">
                        <form id="data-form">
                            <div class="form-group">
                                <label for="inputName">Full Name</label>
                                <input type="text" class="form-control" id="inputName" placeholder="Enter your name">
                                <!--<small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>-->
                            </div>
                            <div class="form-group">
                                <label for="inputInstitution">Institution</label>
                                <input type="text" class="form-control" id="inputInstitution" placeholder="Enter the institution you came from">
                            </div>
                            <!--
                            <div class="form-group">
                                <label for="inputOccupation">Occupation</label>
                                <input type="text" class="form-control" id="inputOccupation" placeholder="Enter your current ocupation">
                            </div>
                            -->
                            <div class="form-group">
                                <label for="inputEnrollment">Current enrollment</label>
                                <select class="form-control" id="inputEnrollment" placeholder="Current enrollment">
                                    <option selected disabled>Select your current enrollment</option>
                                </select>
                            </div>
                            <div class="form-check">
                                <label class="form-check-label">
                                <input id="inputOral" type="checkbox" class="form-check-input">
                                I wish to give an oral contribution
                                </label>
                                <small>Oral presentation must be given in english</small>
                            </div>
                            <div class="form-check">
                                <label class="form-check-label">
                                <input id="inputPoster" type="checkbox" class="form-check-input">
                                I wish to present at the poster session
                                </label>
                                <small>Poster should follow rules described on <a href="#" onclick="$('#signed-tab a:first').tab('show')">General Info</a></small>
                            </div>
                            <fieldset class="form-group">
                                <legend></legend>
                                <button type="submit" class="btn btn-primary pull-right">Submit</button>
                            </fieldset>
                        </form>
                    </div>
                    
                    <!-- tab pane 3 -->
                    <div role="tabpanel" class="tab-pane" id="abstract">
                        <form id="abstract-form">
                            <div class="form-group">
                                <label for="inputTitle">Title</label>
                                <input type="text" class="form-control" id="inputTitle" placeholder="Enter the title of your work">
                                <!--<small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>-->
                            </div>
                            <div class="form-group">
                                <label for="inputAuthors">Authors</label>
                                <input type="text" class="form-control" id="inputAuthors" placeholder="Enter the name of the authors, semicolon separated">
                            </div>
                            <div class="form-group">
                                <label for="inputInstitutions">Institutions</label>
                                <input type="text" class="form-control" id="inputInstitutions" placeholder="Enter the name of the institutions, semicolon separated">
                            </div>
                            <div class="form-group">
                                <label for="inputKeywords">Keywords</label>
                                <input type="text" class="form-control" id="inputKeywords" placeholder="Enter keywords, comma separated">
                            </div>
                            <div class="form-group">
                                <label for="inputText">Abstract</label>
                                <small>2000 character limit</small>
                                <textarea class="form-control" id="inputText" rows="10" maxlength="2000"></textarea>
                            </div>
                            <fieldset class="form-group">
                                <legend></legend>
                                <button type="submit" class="btn btn-primary pull-right">Submit</button>
                            </fieldset>
                        </form>
                        <div id="abstract-view">
                            <p id="title"></p>
                            <p id="authors"></p>
                            <p id="institutions"></p>
                            <p id="text"></p>
                            <p id="keywords"></p>
                            <fieldset class="form-group" id="alterBtn">
                                <legend></legend>
                                <button class="btn btn-primary pull-right">Alter abstract</button>
                            </fieldset>
                        </div>
                    </div>

                    <!-- tab pane 4 -->
                    <div role="tabpanel" class="tab-pane" id="payment">
                        <p>Payment status will be updated once we're notified.</p>
                        <table class="table table-bordered">
                            <tr>
                                <td>
                                    <b>
                                    For brazilian participants
                                    </b>
                                </td>
                                <td>
                                    <form id="psForm" action="https://pagseguro.uol.com.br/checkout/v2/payment.html" method="post">
                                        <p id="description"></p>
                                        <span>Registration fee: R$</span>
                                        <span id="fee"></span>
                                        <br/>
                                        <input type="hidden" name="code" id="productId" value="" />
                                        <input type="hidden" name="iot" value="button" />
                                        <input type="image" src="https://stc.pagseguro.uol.com.br/public/img/botoes/pagamentos/209x48-comprar-preto-assina.gif" name="submit" alt="Pague com PagSeguro - é rápido, grátis e seguro!" />
                                    </form>
                                    <span id="enrollment-alert">Please submit your current enrollment.</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>
                                        For foreign participants
                                    </b>
                                </td>
                                <td>
                                    <a class="btn btn-primary" href="https://sec.sbfisica.org.br/eventos/extras/sbss/sys/" role="button" target="_blank">Register for payment</a>
                                    <a class="btn btn-primary" href="https://sec.sbfisica.org.br/eventos/extras/sbss/sys/index1.asp" role="button" target="_blank">Check registration</a>
                                </td>
                            </tr>
                        </table>
                    </div>

                </div>

            </div>

        </div>
    </div>

    <div class="container">
        <a href="../">
        <p style="margin-top:50px; text-align: center">Back to home page</p>
        </a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDdID4WJ4AgV_7wKJjSqnqu-5n6pgYmdhE",
        authDomain: "registration-bb950.firebaseapp.com",
        databaseURL: "https://registration-bb950.firebaseio.com",
        storageBucket: "registration-bb950.appspot.com",
        messagingSenderId: "543622323909"
    };
    firebase.initializeApp(config);
    </script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script>
    $(document).ready(function() {
        // $('#login-container form').submit(function(e){
        $('form:not(#psForm)').submit(function(e){
            e.preventDefault();
        });
        
        $('#alterBtn button').click(function(e){
            $('#abstract-view').hide();
            $('#abstract-form').show();
        });        

        $('#data-form').submit(function(){
            var name = $(this).find('#inputName').val();
            var institution = $(this).find('#inputInstitution').val();
            var occupation = $(this).find('#inputOccupation').val();
            var enrollment = $(this).find('#inputEnrollment').val();
            var oral = $(this).find('#inputOral').prop('checked');
            var poster = $(this).find('#inputPoster').prop('checked');

            setUserData({
                name: name,
                institution: institution,
                enrollment: enrollment,
                oral: oral,
                poster: poster
            });
        });

        $('#abstract-form').submit(function(){
            var title = $(this).find('#inputTitle').val();
            var authors = $(this).find('#inputAuthors').val();
            var institutions = $(this).find('#inputInstitutions').val();
            var keywords = $(this).find('#inputKeywords').val();
            var text = $(this).find('#inputText').val();

            setAbstractData({
                title: title,
                authors: authors,
                institutions: institutions,
                keywords : keywords,
                text: text
            });
        });

        $('#registerBtn').click(function(){
            var email = $('#inputEmailRegister').val();
            var password = $('#inputPasswordRegister').val();
            firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
                console.log(error.message);
		        alert(error.message);
            });
        });

        $('#signinBtn').click(function(){
            var email = $('#inputEmailSignIn').val();
            var password = $('#inputPasswordSignIn').val();
            firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
                console.log(error.message);
                alert(error.message);
            });
        });

        $('#resetBtn').click(function(){
            var email = $('#inputEmailReset').val();
            firebase.auth().sendPasswordResetEmail(email).then(function() {
                alert("Password reset email sent.");
            }, function(error) {
                alert(error);
            });
        });

        $('#logOutBtn').click(function(){
            firebase.auth().signOut();
        });

        $('#logOutTab').click(function(){
            if (confirm("You are about to log out."))
                firebase.auth().signOut();
        });

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                signIn(user);


                // Create a reference to the file we want to download
                var storage = firebase.storage();
                var storageRef = storage.ref();

                var attendee = storageRef.child('certificates/attendees/'+user.uid+'.pdf');

                // Get the download URL
                attendee.getDownloadURL().then(function(url) {
                    // Insert url into an <img> tag to "download"
                    displayCertificate(url);
                }).catch(function(error) {
                    switch (error.code) {
                        case 'storage/object_not_found':
                        // File doesn't exist
                        break;

                        case 'storage/unauthorized':
                        // User doesn't have permission to access the object
                        break;

                        case 'storage/canceled':
                        // User canceled the upload
                        break;

                        case 'storage/unknown':
                        // Unknown error occurred, inspect the server response
                        break;
                    }
                });

                var speaker = storageRef.child('certificates/speakers/'+user.uid+'.pdf');

                // Get the download URL
                speaker.getDownloadURL().then(function(url) {
                    // Insert url into an <img> tag to "download"
                    displaySpeakerCertificate(url);
                }).catch(function(error) {
                    switch (error.code) {
                        case 'storage/object_not_found':
                        // File doesn't exist
                        break;

                        case 'storage/unauthorized':
                        // User doesn't have permission to access the object
                        break;

                        case 'storage/canceled':
                        // User canceled the upload
                        break;

                        case 'storage/unknown':
                        // Unknown error occurred, inspect the server response
                        break;
                    }
                });

                firebase.database().ref('users/' + user.uid + '/profile').on('value', function(snapshot) {
                    if(snapshot.val() !== null)
                        updateProfileFields(snapshot.val());
                });

                firebase.database().ref('users/' + user.uid + '/paid').on('value', function(snapshot) {
                    updatePaymentAlert(snapshot.val());
                });

                firebase.database().ref('abstracts/' + user.uid).on('value', function(snapshot) {
                    // if(snapshot.val() !== null)
                        updateAbstractFields(snapshot.val());
                });

            } else {
                signOut();
            }
        });

        function signIn(user){
            $('#login-container').hide();
            $('#info-container').show();
        }

        function signOut(){
            $('#info-container').hide();
            $('#login-container').show();
            $('#login-container form').trigger('reset');
        }

        function setUserData(data) {
            var user = firebase.auth().currentUser;

            if (user != null) {
                firebase.database().ref('users/' + user.uid + '/profile').set(data)
                .then(function() {
                    successAlert();
                })
                .catch(function(error) {
                    console.log(error);
                    errorAlert();
                });
            }
        }
        
        function setAbstractData(data) {
            var user = firebase.auth().currentUser;

            if (user != null) {
                firebase.database().ref('abstracts/' + user.uid).set(data)
                .then(function() {
                    successAlert();

                })
                .catch(function(error) {
                    console.log(error);
                    errorAlert();
                });
            }
        }

        function updateProfileFields(snapshot){
            console.log('update',snapshot);
            //user profile
            $('#data-form #inputName').val(snapshot.name);
            $('#data-form #inputInstitution').val(snapshot.institution);
            $('#data-form #inputOccupation').val(snapshot.occupation);
            $('#data-form #inputOral').prop('checked', snapshot.oral);
            $('#data-form #inputPoster').prop('checked', snapshot.poster);

            if(snapshot.enrollment != null){
                $('#psForm').show();
                $('#enrollment-alert').hide();

                $('#data-form #inputEnrollment option[value="' + snapshot.enrollment + '"]').prop('selected', true);

                firebase.database().ref('info/enrollment/' + snapshot.enrollment).once('value').then(function(enrollmentSnapshot) {
                    $('#psForm #description').text(enrollmentSnapshot.val().title);
                    $('#psForm #fee').text(enrollmentSnapshot.val().price);
                    $('#psForm #productId').val(enrollmentSnapshot.val().productId);
                });
            } else {
                $('#psForm').hide();
                $('#enrollment-alert').show();
            }

        }

        function displayCertificate(url){
            $('li[role="presentation"]:not(#logOutTab)').hide();
            $('#certificateTab').show();

            $('[href="#certificates"]').tab('show');

            $('#attendeeCertificate').attr('href',url)
        }

        function displaySpeakerCertificate(url){
            $('li[role="presentation"]:not(#logOutTab)').hide();
            $('#certificateTab').show();

            $('[href="#certificates"]').tab('show');

            $('#speakerCertificate').show();
            $('#speakerCertificate').attr('href',url)
        }

        function updatePaymentAlert(snapshot){
            // payment alert
            if(snapshot != 1){
                $("#payment-success").hide();
                $(".alert-warning").slideDown("fast");
            }
            else {
                $(".alert-warning").hide();
                $("#payment-success").slideDown("fast");
            }
        }

        function updateAbstractFields(snapshot){

            if(snapshot != null){
                var emptyFieldCount = 0;
                for(var teste in snapshot) {
                    emptyFieldCount += $.trim(snapshot[teste]) === "";
                }

                if(emptyFieldCount > 0){
                    //abstract-form
                    $('#abstract-view').hide();
                    $('#abstract-form').show();
                } else {
                    //abstract-view
                    $('#abstract-form').hide();
                    $('#abstract-view').show();
                }

                //abstract-form
                $('#abstract-form #inputTitle').val(snapshot.title);
                $('#abstract-form #inputAuthors').val(snapshot.authors);
                $('#abstract-form #inputInstitutions').val(snapshot.institutions);
                $('#abstract-form #inputKeywords').val(snapshot.keywords);
                $('#abstract-form #inputText').val(snapshot.text);

                //abstract-view
                $('#abstract-view #title').text(snapshot.title);
                $('#abstract-view #authors').text(snapshot.authors);
                $('#abstract-view #institutions').text(snapshot.institutions);
                $('#abstract-view #text').text(snapshot.text);
                $('#abstract-view #keywords').text('Keywords: '+snapshot.keywords);
            } else {
                //abstract-form
                $('#abstract-view').hide();
                $('#abstract-form').show();
            }
        }

        function successAlert() {
            $("#update-success").slideDown("fast");

            setTimeout(function() {
                $("#update-success").slideUp(500, function() {
                    $(this).hide();
                });
            }, 2500);
        }

        function errorAlert() {
            $(".alert-danger").slideDown("fast");

            setTimeout(function() {
                $(".alert-danger").slideUp(500, function() {
                    $(this).hide();
                });
            }, 2500);
        }

        firebase.database().ref("info").on("value", function(data){
            var info = data.val();

            $('#db-info').html(info.txt);

            $.each(info.enrollment, function(index, value) {
                $('#inputEnrollment').append($("<option />").val(index).text(value.title));
            });

            // Poster Countdown
            countdown(info.posterDeadline, "#poster-countdown", function(){
                $("#inputPoster").attr("disabled", true);                
                $('#abstract-form').hide();
                $('#abstract-view').show();
                $('#abstract fieldset').hide();
                // $("#abstractTab").addClass("disabled").click(function (e) {
                //     e.preventDefault();
                //     return false;
                // });
            });
            
            // Oral Countdown
            countdown(info.oralDeadline, "#oral-countdown", function(){
                $("#inputOral").attr("disabled", true);
            });

        }, function(err){
            alert(err);
        });

        //COUNTDOWN
        function countdown(deadline, selector, expire){
            var interval = setInterval(function() {

                var now = new Date().getTime();

                var distance = new Date(deadline).getTime() - now;

                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                $(selector).text(days+"d "+hours+"h "+minutes+"m "+seconds+"s");

                if (distance < 0) {
                    clearInterval(interval);
                    $(selector).text("EXPIRED");
                    expire();
                }
            }, 1000);
        }
    });

    </script>
  </body>
</html>
